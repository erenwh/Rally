!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("ZalgoPromise",[],r):"object"==typeof exports?exports.ZalgoPromise=r():e.ZalgoPromise=r()}(this,function(){return function(e){function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var t={};return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s="./src/export.js")}({"./src/exceptions.js":function(e,r,t){"use strict";function n(e){if(-1===(0,i.getGlobal)().dispatchedErrors.indexOf(e)){(0,i.getGlobal)().dispatchedErrors.push(e),setTimeout(function(){throw e},1);for(var r=0;r<(0,i.getGlobal)().possiblyUnhandledPromiseHandlers.length;r++)(0,i.getGlobal)().possiblyUnhandledPromiseHandlers[r](e)}}function o(e){return(0,i.getGlobal)().possiblyUnhandledPromiseHandlers.push(e),{cancel:function(){(0,i.getGlobal)().possiblyUnhandledPromiseHandlers.splice((0,i.getGlobal)().possiblyUnhandledPromiseHandlers.indexOf(e),1)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.dispatchPossiblyUnhandledError=n,r.onPossiblyUnhandledException=o;var i=t("./src/global.js")},"./src/export.js":function(e,r,t){"use strict";e.exports=t("./src/promise.js").ZalgoPromise,e.exports.ZalgoPromise=t("./src/promise.js").ZalgoPromise},"./src/global.js":function(e,r,t){"use strict";function n(){return window.__zalgopromise__||(window.__zalgopromise__={flushPromises:[],activeCount:0,possiblyUnhandledPromiseHandlers:[],dispatchedErrors:[]}),window.__zalgopromise__}Object.defineProperty(r,"__esModule",{value:!0}),r.getGlobal=n},"./src/promise.js":function(e,r,t){"use strict";function n(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.ZalgoPromise=void 0;var o=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),i=t("./src/utils.js"),s=t("./src/exceptions.js"),u=t("./src/global.js"),l=function(){function e(r){var t=this;if(n(this,e),this.resolved=!1,this.rejected=!1,this.errorHandled=!1,this.handlers=[],r){var o=void 0,i=void 0,s=!1,u=!1,l=!1;try{r(function(e){l?t.resolve(e):(s=!0,o=e)},function(e){l?t.reject(e):(u=!0,i=e)})}catch(e){return void this.reject(e)}l=!0,s?this.resolve(o):u&&this.reject(i)}}return o(e,[{key:"resolve",value:function(e){if(this.resolved||this.rejected)return this;if((0,i.isPromise)(e))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=e,this.dispatch(),this}},{key:"reject",value:function(e){var r=this;if(this.resolved||this.rejected)return this;if((0,i.isPromise)(e))throw new Error("Can not reject promise with another promise");if(!e){var t=e&&"function"==typeof e.toString?e.toString():Object.prototype.toString.call(e);e=new Error("Expected reject to be called with Error, got "+t)}return this.rejected=!0,this.error=e,this.errorHandled||setTimeout(function(){r.errorHandled||(0,s.dispatchPossiblyUnhandledError)(e)},1),this.dispatch(),this}},{key:"asyncReject",value:function(e){this.errorHandled=!0,this.reject(e)}},{key:"dispatch",value:function(){var r=this,t=this.dispatching,n=this.resolved,o=this.rejected,s=this.handlers;if(!t&&(n||o)){this.dispatching=!0,(0,u.getGlobal)().activeCount+=1;for(var l=0;l<s.length;l++){(function(t){var u=s[t],l=u.onSuccess,c=u.onError,a=u.promise,f=void 0;if(n)try{f=l?l(r.value):r.value}catch(e){return a.reject(e),"continue"}else if(o){if(!c)return a.reject(r.error),"continue";try{f=c(r.error)}catch(e){return a.reject(e),"continue"}}f instanceof e&&(f.resolved||f.rejected)?(f.resolved?a.resolve(f.value):a.reject(f.error),f.errorHandled=!0):(0,i.isPromise)(f)?f instanceof e&&(f.resolved||f.rejected)?f.resolved?a.resolve(f.value):a.reject(f.error):f.then(function(e){a.resolve(e)},function(e){a.reject(e)}):a.resolve(f)})(l)}s.length=0,this.dispatching=!1,(0,u.getGlobal)().activeCount-=1,0===(0,u.getGlobal)().activeCount&&e.flushQueue()}}},{key:"then",value:function(r,t){if(r&&"function"!=typeof r&&!r.call)throw new Error("Promise.then expected a function for success handler");if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.then expected a function for error handler");var n=new e;return this.handlers.push({promise:n,onSuccess:r,onError:t}),this.errorHandled=!0,this.dispatch(),n}},{key:"catch",value:function(e){return this.then(void 0,e)}},{key:"finally",value:function(r){return this.then(function(t){return e.try(r).then(function(){return t})},function(t){return e.try(r).then(function(){throw t})})}},{key:"timeout",value:function(e,r){var t=this;if(this.resolved||this.rejected)return this;var n=setTimeout(function(){t.resolved||t.rejected||t.reject(r||new Error("Promise timed out after "+e+"ms"))},e);return this.then(function(e){return clearTimeout(n),e})}},{key:"toPromise",value:function(){if(!window.Promise)throw new Error("Could not find window.Promise");return window.Promise.resolve(this)}}],[{key:"resolve",value:function(r){return r instanceof e?r:(0,i.isPromise)(r)?new e(function(e,t){return r.then(e,t)}):(new e).resolve(r)}},{key:"reject",value:function(r){return(new e).reject(r)}},{key:"all",value:function(r){var t=new e,n=r.length,o=[];if(!n)return t.resolve(o),t;for(var s=0;s<r.length;s++){(function(s){var u=r[s];if(u instanceof e){if(u.resolved)return o[s]=u.value,n-=1,"continue"}else if(!(0,i.isPromise)(u))return o[s]=u,n-=1,"continue";e.resolve(u).then(function(e){o[s]=e,0===(n-=1)&&t.resolve(o)},function(e){t.reject(e)})})(s)}return 0===n&&t.resolve(o),t}},{key:"hash",value:function(r){var t={};return e.all(Object.keys(r).map(function(n){return e.resolve(r[n]).then(function(e){t[n]=e})})).then(function(){return t})}},{key:"map",value:function(r,t){return e.all(r.map(t))}},{key:"onPossiblyUnhandledException",value:function(e){return(0,s.onPossiblyUnhandledException)(e)}},{key:"try",value:function(r,t,n){var o=void 0;try{o=r.apply(t,n||[])}catch(r){return e.reject(r)}return e.resolve(o)}},{key:"delay",value:function(r){return new e(function(e){setTimeout(e,r)})}},{key:"isPromise",value:function(r){return!!(r&&r instanceof e)||(0,i.isPromise)(r)}},{key:"flush",value:function(){var r=new e;return(0,u.getGlobal)().flushPromises.push(r),0===(0,u.getGlobal)().activeCount&&e.flushQueue(),r}},{key:"flushQueue",value:function(){var e=(0,u.getGlobal)().flushPromises;(0,u.getGlobal)().flushPromises=[];for(var r=e,t=Array.isArray(r),n=0,r=t?r:r[Symbol.iterator]();;){var o;if(t){if(n>=r.length)break;o=r[n++]}else{if(n=r.next(),n.done)break;o=n.value}o.resolve()}}}]),e}();r.ZalgoPromise=l},"./src/utils.js":function(e,r,t){"use strict";function n(e){try{if(!e)return!1;if(window.Promise&&e instanceof window.Promise)return!0;if(window.Window&&e instanceof window.Window)return!1;if(window.constructor&&e instanceof window.constructor)return!1;var r={}.toString;if(r){var t=r.call(e);if("[object Window]"===t||"[object global]"===t||"[object DOMWindow]"===t)return!1}if("function"==typeof e.then)return!0}catch(e){return!1}return!1}Object.defineProperty(r,"__esModule",{value:!0}),r.isPromise=n}})});
//# sourceMappingURL=zalgo-promise.min.js.map
//# sourceMappingURL=zalgo-promise.min.js.map